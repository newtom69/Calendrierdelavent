@using AdventCalendar.ViewModels
@model CalendarViewModel
@{
    ViewBag.Title = "Index";
    int dayNumber = DateTime.Today.Day;
    const string BoxPreffix = "box";
    const string PicturePreffix = "pict";

}

@if (Model != null)
{
    <h1>Calendrier de l'Avent pour @Model.Calendar.DisplayName</h1>
    <div class="Calendar">
        @for (int i = 1; i <= Model.GenericsPicturesNames.Count; i++)
        {
            string currentBox = BoxPreffix + i;
            string currentPicture = PicturePreffix + i;
            <div class="BoxAndPicture">
                <img id="@currentBox" class="box" src="@Model.GenericsPicturesNames[i]" alt="@(i)" onmouseover="ShowPicture_HideBox(@currentPicture, @currentBox);" />
                @if (Model.PicturesNames.ContainsKey(i))
                {
                    <img id="@currentPicture" class="picture" src="@Model.PicturesNames[i]" alt="@(i)" onclick="Popup_ShowPictures_HideBox(this, @currentBox);" />
                }
                else
                {
                    <img class="hover" src="@Model.GenericsPicturesNames[i]" alt="@(i)" />
                }
            </div>
        }
    </div>
}

<div id="popupPicture" class="popup" ontouchstart="TouchStart()" ontouchmove="TouchMove()" ontouchend="TouchEnd()" onmousemove="ShowButtonsCursor()">
    <div id="largeImageAndButtons">
        <img id="imagePopup" class="popup-content">
        <div id="caption"></div>
        <div id="previousButton"></div>
        <div id="nextButton"></div>
        <div id="previousArea"></div>
        <div id="nextArea"></div>
        <div id="closeButton" class="close"></div>
        <div id="maxScreenButton" class="screenButton"></div>
        <div id="defaultScreenButton" class="screenButton"></div>
    </div>
</div>

<script>

function Popup_ShowPictures_HideBox(pictureToShowPermanently, boxToHidePermanently) {

    ScheduleHideButtonsCursor();

    var previousPictureId = "@PicturePreffix" + (parseInt(pictureToShowPermanently.id.replace("@PicturePreffix", "")) - 1);
    var nextPictureId = "@PicturePreffix" + (parseInt(pictureToShowPermanently.id.replace("@PicturePreffix", "")) + 1);
    PreviousPicture = document.getElementById(previousPictureId);
    NextPicture = document.getElementById(nextPictureId);

    var previousBoxId = "@BoxPreffix" + (parseInt(boxToHidePermanently.id.replace("@BoxPreffix", "")) - 1);
    var nextBoxId = "@BoxPreffix" + (parseInt(boxToHidePermanently.id.replace("@BoxPreffix", "")) + 1);
    PreviousBox = document.getElementById(previousBoxId);
    NextBox = document.getElementById(nextBoxId);

    if (PreviousPicture != null) {
        $('#previousButton').show();
        $('#previoustArea').show();
        $('#previousArea').TouchStart = function () {
            OnMouseInArea(PreviousButton);
        }
        $('#previousArea').TouchEnd = function () {
            OnMouseOutArea(PreviousButton);
        }
    }
    else {
        $('#previousButton').hide();
        $('#previousArea').hide();
    }

    if (NextPicture != null) {
        $('#nextButton').show();
        $('#nextArea').show();
        NextArea.TouchStart = function () {
            OnMouseInArea(NextButton);
        }
        NextArea.TouchEnd = function () {
            OnMouseOutArea(NextButton);
        }
    }
    else {
        $('#nextButton').hide();
        $('#nextArea').hide();
    }
    $('#popupPicture').show();

    ImagePopup.src = pictureToShowPermanently.src;
    $('#caption').html(pictureToShowPermanently.alt)
    ShowPicture_HideBox(pictureToShowPermanently, boxToHidePermanently);
}

    function TouchStart() {
        $('#previousButton').show();
        $('#nextButton').show();
        XBegin = event.touches[0].clientX;
        XDiff = 0;
    }

function TouchMove() {
    XEnd = event.touches[0].clientX;
    XDiff = XEnd - XBegin;
    if (XDiff > 0 && PreviousPicture != null) {
        ImagePopup.style.transform = 'translate(' + XDiff + 'px)';
    }
    else if (XDiff < 0 && NextPicture != null) {
        ImagePopup.style.transform = 'translate(' + XDiff + 'px)';
    }
}

function TouchEnd() {
    if (XDiff > 40 && PreviousPicture != null) {
        $('#imagePopup').hide();
        Popup_ShowPictures_HideBox(PreviousPicture, PreviousBox);
        $('#imagePopup').show();
        ImagePopup.style.transform = 'translate(' + XDiff + 'px)';
    }
    else if (XDiff < -40 && NextPicture != null) {
        $('#imagePopup').hide();
        Popup_ShowPictures_HideBox(NextPicture, NextBox);
        $('#imagePopup').show();
        ImagePopup.style.transform = 'translate(' + XDiff + 'px)';
    }
    ImagePopup.style.transform = 'translate(0px)';
}






</script>